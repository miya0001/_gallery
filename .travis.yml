sudo: false
language: php
notifications:
  email:
    on_success: never
    on_failure: change
branches:
  only:
  - master
  - "/^v?[0-9\\.]+/"
php:
  - 7.2
  - 7.0
env:
  - WP_VERSION=latest WP_MULTISITE=0
  - WP_VERSION=trunk WP_MULTISITE=0
before_script:
  - bash bin/install-wp-tests.sh wordpress_test root '' localhost $WP_VERSION
  - composer install
  - npm install
  - npm run build
script:
  - phpunit
after_success:
  - sed -i -e "s/nightly/${TRAVIS_TAG}/" $(basename $TRAVIS_REPO_SLUG).php
  - curl https://raw.githubusercontent.com/miya0001/auto-build/master/auto-build.sh | bash
deploy:
  provider: releases
  skip_cleanup: true
  api_key:
    secure: yROMVQbTr6D1FszbJC1H5AlghnBschA4wzZvfy60Clf3iVz7KdReDCN784c9bI1hOKhWXdguCq4jgYkk7PqqS+vaZCmVhwlfntrtdJChPJB2PVt2s5TS5zu01024PsYv1u5nzafxv8aq0xTXRYjVYxpCGOmKkcrSChTbv+GpatIaA0BLlHyKF6lzIf3JNZ56Y19AyBxhiE9Mblit9xuHcomjuvCz5MGVDFI+/vswJOy8dIQ3FBeSmZhpTDNmVI4yi6eXjIwdyPNEiAieqmmdAoekFy1+3e3Zj3uvhM799cPyIxhBJCqkaqJpDpgD3ka7fx+OgVBtFxJYS9K9ThzG1Ei6VLSslnKBkEN+w9nG+fHEUAhEI5vxjECH5p4yuV5W8ncd0sRuzWqOJkQINmdmjh/liLFPatlcUQoGBfxDqPcpNiF4sirrTF1E/96NWzlSTsfqMfTdwoxtJUM9wYMD0i2fn27GALtdj4bHptlkZFruBhXj0EGPOgyQYQpYqt5TekSE/QeE7AkB4cqyxUJbSUmQhhjrJyHgseDGmEF7MEUeL2v4/aORH8//XZONr6Zph1mSWs1ZSmVmmPKM1bnFom9hathfYIpWz4/L4+in500NP1Zk0spqfceovFwi8Mbolv3/Ruozi1KKlTditBdGb6j0681OAPOC0ATZPDetm1E=
  file: '_gallery.zip'
  on:
    tags: true
    repo: miya0001/_gallery
